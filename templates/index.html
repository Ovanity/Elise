{% extends "layout.html" %}
{% block title %}Accueil - Humeurs{% endblock %}
{% block content %}

<!-- Expression du jour -->
<div class="box has-text-centered animated fadeIn"
     style="background-color: rgba(255, 240, 245, 0.9);
            border-radius: 15px;
            margin-bottom: 2rem;
            padding: 2rem;
            width: 100%;
            box-sizing: border-box;">
  <h1 class="title" style="color:#D57EAC; font-size: 1.5rem;">🌸 Expression du jour 🌸</h1>
  <p class="is-italic" style="font-size: 1.3rem; color: #8A6878;">
    <strong>{{ word }}</strong>
  </p>
  {% if definition_sentences %}
    <ul style="text-align: left; display: inline-block; margin-top: 1.5rem; color: #5D5C61; font-size:1rem;">
      {% for phrase in definition_sentences %}
        <li style="margin-bottom: 0.6rem;">{{ phrase }}.</li>
      {% endfor %}
    </ul>
  {% else %}
    <p style="font-size: 1rem; margin-top: 1rem; color: #B79CAC;">Aucune définition trouvée.</p>
  {% endif %}
</div>

<!-- Boutons émotionnels -->
<div class="columns is-mobile is-multiline animated fadeInUp" style="margin-bottom: 3rem;">
  <div class="column is-full-mobile is-one-third-tablet">
    <a class="button is-warning is-fullwidth"
       style="background-color:#FFD3B6; color:#5D5C61; font-size:1rem;"
       href="https://www.youtube.com/watch?v=PTFHxGMWhrU&list=PLj5ADQNom7b90sCqUXgjZB8lFJ4TDv-LN">
       😰 Stress/Bad Mood – Playlist Drôle
    </a>
  </div>
  <div class="column is-full-mobile is-one-third-tablet">
    <a class="button is-info is-fullwidth"
       style="background-color:#AEC6CF; color:#5D5C61; font-size:1rem;"
       href="https://www.youtube.com/watch?v=l4fQ0GA1oOI">
       😓 Anxiété/Angoisse – Relaxation d'Urgence
    </a>
  </div>
  <div class="column is-full-mobile is-one-third-tablet">
    <a class="button is-success is-fullwidth"
       style="background-color:#B5EAD7; color:#5D5C61; font-size:1rem;"
       href="https://www.youtube.com/watch?v=3oLtx7xVGRo">
       😌 Détente – 432hz
    </a>
  </div>
</div>

<!-- Utilisateurs -->
<h1 class="title animated fadeInLeft"
    style="color: #D57EAC; margin-bottom:1.5rem; font-size:1.5rem;">
    🌟 Humeurs du moment 🌟
</h1>
{% for user in users %}
  <div class="box user-box animated fadeInUp"
       style="background-color: rgba(255, 253, 250, 0.95);
              border-radius: 12px;
              margin-bottom: 1rem;
              box-shadow: 0 2px 8px rgba(213, 126, 172, 0.15);
              width: 100%;
              box-sizing: border-box;">
    <article class="media" style="align-items: center;">
      <figure class="media-left" style="margin-right:1rem;">
        <p class="image is-64x64">
          <img src="{{ url_for('static', filename='images/' ~ user.profile_pic) }}"
               alt="Photo de {{ user.username }}"
               style="border-radius:50%; border:2px solid #D57EAC;">
        </p>
      </figure>
      <div class="media-content" style="font-size:1rem;">
        <div class="content">
          <h2 class="subtitle" style="margin-bottom:0.5rem;">
            <a href="{{ url_for('user_profile', username=user.username) }}"
               style="color: #8A6878; font-size:1.1rem;">
               {{ user.username }}
            </a>
          </h2>
          {% if user.moods %}
            <p style="color: #5D5C61;">
              Dernière humeur : <strong>{{ user.moods[0].mood_text }}</strong>
              <em style="color:#B79CAC;">({{ user.moods[0].created_at.strftime('%d/%m/%Y %H:%M') }})</em>
            </p>
          {% else %}
            <p style="color: #B79CAC;">Aucune humeur enregistrée.</p>
          {% endif %}
          {% if user.availability == 'Disponible' %}
            <p class="pulsate" style="margin-top:0.3rem;">✨ Disponible <span>😊</span></p>
          {% elif user.availability == 'Seul(e)' %}
            <p class="pulsate" style="margin-top:0.3rem;">🌙 Préfère être seul(e) <span>😐</span></p>
          {% else %}
            <p style="margin-top:0.3rem;">Statut : Inconnu</p>
          {% endif %}
          <p style="color:#8A6878; font-size:0.8rem; margin-top:0.3rem;">
            Dernière visite : {% if user.last_seen %}{{ user.last_seen.strftime('%d/%m/%Y %H:%M') }}{% else %}N/A{% endif %}<br>
Nombre de visites : {{ user.visit_count }}
        </div>
      </div>
    </article>
  </div>
{% endfor %}

<!-- Boîte à idées musicales -->
<div class="container" style="max-width:100%; padding:0;">
  <div class="box animated fadeInRight"
       style="background-color: rgba(255,239,250,0.9);
              border-radius:10px;
              padding:1rem;
              margin-top:1rem;
              width:100%;
              box-sizing:border-box;">

    <h1 class="title" style="color:#D57EAC; font-size:1.2rem; margin-bottom:1.5rem;">
      💡 Boîte à idées 💡
    </h1>

    <p class="subtitle" style="color:#8A6878; font-size:0.9rem; margin-bottom z:1rem;">
      Partage une musique, une vidéo, une suggestion ou un petit mot ✨
    </p>

    {% if session.username %}
      <form method="POST" action="{{ url_for('add_idea') }}">
        <div class="field">
          <textarea class="textarea"
                    name="idea_text"
                    placeholder="Un lien ou ta pensée du jour..."
                    required
                    style="border-radius:6px; font-size:0.85rem; padding:0.5rem;"></textarea>
        </div>
        <button class="button is-success"
                type="submit"
                style="background-color:#D57EAC; color:#fff; font-size:0.85rem; padding:0.4rem 1rem;">
          Poster mon idée 💌
        </button>
      </form>
    {% else %}
      <p style="font-size:0.9rem; color:#8A6878;">
        🔒 <a href="{{ url_for('login') }}" style="color:#D57EAC;">Connecte-toi</a> pour partager ton idée.
      </p>
    {% endif %}

    {% if ideas %}
  <div style="margin-top: 1rem;">
    {% for idea in ideas %}
      <!-- Bubble Container -->
      <div class="animated fadeInUp"
           style="
             display: inline-block;
             background-color: #FFFFFF;
             border-radius: 10px;
             box-shadow: 0 1px 3px rgba(0,0,0,0.1);
             padding: 0.6rem 0.8rem;
             margin-bottom: 0.8rem;
             max-width: 80%;
             width: auto;
             box-sizing: border-box;
           ">

        <!-- Top Row: Profile pic on top, text below (left-aligned) -->
<div style="text-align: left;">
  <img src="{{ url_for('static', filename='images/' ~ idea.author.profile_pic) }}"
       alt="{{ idea.author.username }}"
       style="width: 35px; height: 35px; border-radius: 50%; border: 1px solid #D57EAC; display:block; margin-bottom:0.3rem;">
  <p style="margin: 0; font-size: 0.85rem; color: #5D5C61;">
    {{ idea.idea_text }}
  </p>
</div>

        <!-- Bottom Row: Time + Delete Button -->
        <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 0.4rem;">
          <small style="font-size: 0.7rem; color: #B79CAC;">
            {{ idea.created_at.strftime('%d/%m/%Y %H:%M') }}
          </small>

          {% if session.username == idea.author.username %}
            <form method="POST" action="{{ url_for('delete_idea', idea_id=idea.id) }}">
              <button type="submit"
                      style="border: none; background: none; color: #FF5555; font-size: 0.8rem; padding: 0.5; cursor: pointer;">
                ❌
              </button>
            </form>
          {% endif %}
        </div>
      </div>
    {% endfor %}
  </div>
{% else %}
  <p style="font-size: 0.9rem; color:#B79CAC; margin-top:1rem;">
    Sois la première à partager une idée ! 🌷
  </p>
{% endif %}
  </div>
</div>

<!-- Petit guide -->
<div class="box animated fadeInUp"
     style="background-color: rgba(255,250,255,0.9);
            border-radius: 12px;
            color: #8A6878;
            margin-top: 2rem;
            padding: 1.5rem;
            font-size:0.95rem;">
  <p><strong>🌷 Petit guide :</strong></p>
  <ul style="margin-top:0.5rem;">
    <li>📖 <strong>Expression du jour :</strong> Découvre chaque jour une jolie expression française pour enrichir notre vocabulaire.</li>
    <li>💖 <strong>Boutons émotionnels :</strong> Ressources rapides adaptées à ton humeur.</li>
    <li>👥 <strong>Humeurs :</strong> Découvre comment se sentent les autres et s'ils sont disponibles mentalement.</li>
    <li>💡 <strong>Boîte à idées :</strong> Partage ce qui te tient à cœur. Tu peux supprimer tes propres idées.</li>
  </ul>
</div>

{% endblock %}