{% extends "layout.html" %}
{% block title %}Profil de {{ username }}{% endblock %}

{% block content %}
<div class="container animated fadeIn" style="max-width:600px; margin:auto; padding:1rem; text-align:center;">

  <h1 class="title" style="color:#D57EAC; margin-bottom:1rem; font-size:1.5rem;">ğŸŒ¸ Profil de {{ username }} ğŸŒ¸</h1>

  <!-- Profile Picture -->
  <figure class="image is-128x128" style="margin:1rem auto;">
    <img src="{{ url_for('static', filename='images/' ~ user.profile_pic) }}" alt="{{ username }}"
         style="border-radius:50%; border:3px solid #D57EAC;">
  </figure>

  <!-- Current Mood and Availability -->
  <div class="box" style="background-color: rgba(255,250,255,0.95); border-radius:15px; margin-top:1rem; padding:1.5rem;">
    <p class="subtitle" style="color:#8A6878; font-size:1.3rem;">
      <strong>âœ¨ Humeur actuelle :</strong> {{ mood }}
    </p>
    <p class="subtitle" style="color:#8A6878; font-size:1.3rem;">
      <strong>ğŸŒŸ DisponibilitÃ© :</strong> {{ user.availability|capitalize }}
    </p>
  </div>

  {% if session.username == username %}
    <!-- User actions (change photo and add mood) -->
    <div class="buttons is-centered" style="margin-top:1rem;">
      <a class="button" style="background-color:#B5EAD7; color:#5D5C61;" href="{{ url_for('choose_profile_pic') }}">
        ğŸ–¼ï¸ Changer la photo
      </a>
      <a class="button" style="background-color:#AEC6CF; color:#5D5C61;" href="{{ url_for('add_mood') }}">
        âœï¸ Ajouter une humeur
      </a>
    </div>

    <!-- Availability update form with vertically stacked buttons -->
    <form method="POST" action="{{ url_for('update_availability') }}" style="margin-top:1rem;">
      <div class="field" style="text-align: center;">
        <button name="availability" value="Disponible" class="button" type="submit"
                style="background-color:#D57EAC; color:#fff; display:block; margin:0.5rem auto; width:80%;">
          ğŸ˜Š Disponible pour discuter
        </button>
        <button name="availability" value="Seul(e)" class="button" type="submit"
                style="background-color:#FFAAA5; color:#fff; display:block; margin:0.5rem auto; width:80%;">
          ğŸ˜” PrÃ©fÃ¨re Ãªtre seul(e)
        </button>
      </div>
    </form>
  {% else %}
    <p style="color:#8A6878; margin-top:1rem;">
      ğŸ”’ Vous n'Ãªtes pas connectÃ©(e) en tant que {{ username }}.<br>
      <a href="{{ url_for('login') }}" style="color:#D57EAC;">Connexion</a>
    </p>
  {% endif %}

  <!-- Button to view mood history -->
  <div style="margin-top:2rem;">
    <a class="button" style="background-color:#FFD3B6; color:#5D5C61; font-size:1rem;"
       href="{{ url_for('user_moods', username=username) }}">
      ğŸ“… Voir l'historique des Ã©motions
    </a>
  </div>

  <div class="box" style="background-color: rgba(255,250,255,0.95); border-radius:15px; padding:1rem; margin-top:1rem;">
  <p class="subtitle" style="color:#8A6878; font-size:1.1rem;">
    DerniÃ¨re visite : {% if user.last_seen %}{{ user.last_seen.strftime('%d/%m/%Y %H:%M') }}{% else %}N/A{% endif %}<br>
  </p>
  <p class="subtitle" style="color:#8A6878; font-size:1.1rem;">
    <strong>Nombre de visites :</strong> {{ user.visit_count }}
  </p>
</div>

  <!-- Discreet guide at the bottom -->
  <div class="box animated fadeInUp" style="background-color: rgba(255,250,255,0.95); border-radius:12px; color: #8A6878; margin-top:2rem; padding:1rem; font-size:0.9rem; text-align:left;">
    <p><strong>ğŸŒ· Petit guide du profil :</strong></p>
    <ul style="margin-top:0.5rem; list-style:none; padding-left:0;">
      <li>ğŸ–¼ï¸ <strong>Photo :</strong> Personnalise ton profil avec une jolie image.</li>
      <li>âœ¨ <strong>Humeur :</strong> Exprime comment tu te sens aujourd'hui.</li>
      <li>ğŸŒŸ <strong>DisponibilitÃ© :</strong> Informe les autres de ta disponibilitÃ© mentale.</li>
      <li>ğŸ“… <strong>Historique :</strong> Consulte toutes tes humeurs prÃ©cÃ©dentes.</li>
    </ul>
  </div>
</div>

<style>
  /* Fade-in animation for smooth appearance */
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }
  .animated.fadeIn {
    animation: fadeIn 1s ease-out;
  }

  /* Responsive adjustments for mobile */
  @media (max-width:768px) {
    .title { font-size:2rem; }
    .subtitle { font-size:1.3rem; }
    .button { padding:0.8rem 1.2rem; font-size:0.9rem; }
  }
</style>
{% endblock %}